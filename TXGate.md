# TX Gate

## Перечень запросов
  - [Авторизация](#-Авторизация)
  - [Вызов API](#-Вызов-методов-API)
  - [Состояние запроса](#-Состояние-запроса)
  - [Ping](#-Ping)


## Авторизация
  Авторизация проводится POST-запросом txgate/auth/login
  В теле запроса необходимо указать логин и пароль в json-формате
  {"user": "login", "password": "pass"}

  В случае успеха gate вернётся 200 OK
  Ключ сессии вернётся в заголовке SessionID
  Время жизни сессии зависит от настроек сервера и обычно составляет
  несколько минут (с момента последнего обращения).

    curl -X POST http://localhost:83/txgate/auth/login \
        -H 'Content-Type: application/json' \
        -d '{"user": "login", "password": "pass"}'


## Вызов методов API
  Вызов методов API осуществляется POST-запросом txgate/turbo9/{ИмяМетода}
  имя метода передаётся через URL в формате txgate/turbo9/ИмяМетода
  параметры, если необходимы, передаются в теле запроса
  Заголовки запроса:
    SessionID: ключ сессии, полученный предшествующим вызовом auth/login
    Callback: Callback-адрес, на который будет направлен ответ в случае длительной обработки

  В случае если запрос был успешно выполнен сразу, он возвращает 200 OK
  Результат работы возвращается в теле запроса, в формате
  Content-Type: plain/text; charset=utf-8

  Если обработка запроса может занять некоторое время, то он возвращает 202 Accepted
  В теле ответа при этом вернётся json с идентификатором принятого запроса {"eventID": 123}.
  Результат его выполнения будет направлен POST-запросом на адрес указанный в заголовке Callback

  В случае если сессия просрочена, запрос возвращает 401 Unauthorized
  В таком случае необходимо получить новый ключ и повторить запрос уже с ним.

    curl -X POST http://localhost:83/txgate/turbo9/Сис2.СтроковыеФункции.СБольшойБуквы \
        -H 'Callback: https://turbotechnology.ru/gptest/at.php' \
        -H 'SessionID: 9956E8310A78CD533704412D' \
        -d тест

  Если первый символ переданный строки маленькая буква, то данная функция заменит её на большую.
  Т.е. в примере вернётся строка "Тест".
  
  ***Перечень методов API***
  - [API управления услугами(договорами обслуживания)](https://github.com/turbotechnology/ISOLA.APIGate/blob/main/API_ClientManagement.md)
  - [API получения состояния счетов (портфелей)](https://github.com/turbotechnology/ISOLA.APIGate/blob/main/API_PortfolioState.md)
  - [API операционных документов]


## Состояние запроса
  Для получения информации о состоянии исполнения запроса используется GET-запрос event/status/{eventId}
  идентификатор запроса передаётся через URL в формате txgate/event/status/123
  Заголовки запроса:
    SessionID: ключ сессии, полученный предшествующим вызовом auth/login

  В случае успеха запрос возвращает 200 OK
  Результат работы возвращается в формате Content-Type: application/json; charset=utf-8
  Пример:
    {"event": {
        "eventID": 123,
        "modifyDate": "21.12.2012 12:34:56",
        "request": "Сис2.СтроковыеФункции.СБольшойБуквы",
        "data": "тест",
        "priority": 0,
        "status": 10,
        "owner": "Dispatcher",
        "callback": ""
      }
    }

  В случае если сессия просрочена, запрос возвращает 401 Unauthorized
  В таком случае необходимо получить новый ключ и повторить запрос уже с ним.

    curl http://localhost:83/txgate/event/status/7 \
        -H 'SessionID: 9956E8310A78CD533704412D'


## Ping
  Для проверки работоспособности сервера используется GET-запрос

    curl http://localhost:83/txgate/ping
