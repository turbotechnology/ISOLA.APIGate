# API: состав активов

## Пример данных 1

http://atb-private.fmake.ru/clients/9805
Имя: Брокер 002587735 DEMO
Договор на обслуживание N027740790
Два разных счёта
Параметры: [ClientID=9805,TableSplit=10]


## Пример данных 2

http://atb-private.fmake.ru/clients/9817
Имя: Клиент 056859943
Договор на обслуживание N023693189
Один счет, много инструментов
Параметры: [ClientID=9817,TableSplit=10]



----------
## Функция GetUserAccountState класса FrontOffice

Параметры передаются в виде “[ClientID=X,AgreementID=Y,TableSplit=Z]”
Пробелы в параметре значащие и в данной функции — недопустимы.
ClientID — DocID клиента
AgreementID — DocID договора
TableSplit — вид разбиения, может принимать одно из следующих значений: 0 - без разбиения, 1 - разбиение по счетам, 2 - разбиение по инструментам, 10 - данные для УРМОКС
Возвращает состав активов портфеля в виде xml.
Все возвращаемые тэги и атрибуты необязательны.

----------
## Пример для TableSplit=10 (для УРМОКС)

Состав активов клиента:
`$t9->ProcCall('web.FrontOffice', 'GetUserAccountState', '[ClientID=9817,TableSplit=10]')`
Состав активов по договору:
`$t9->ProcCall('web.FrontOffice', 'GetUserAccountState', '[AgreementID=1702531,TableSplit=10]')`
Возвращаемое значение:

    <AccountState>
        <Row Портфель.DocID="1702531" ЦБ.ВалютаНоминала.ИСОКод="RUR" ЦБ.ВидЦБ.Мнемокод="Денежные средства" Стоимость="1000.00"/>
        <Row Портфель.DocID="1702531" ЦБ.ВалютаНоминала.ИСОКод="RUR" ЦБ.ВидЦБ.Мнемокод="Опцион" Стоимость=""/>
        <Row Портфель.DocID="1702531" ЦБ.ВалютаНоминала.ИСОКод="CNY" ЦБ.ВидЦБ.Мнемокод="Денежные средства" Стоимость="9860700.00"/>
        <Row Портфель.DocID="1702531" ЦБ.ВалютаНоминала.ИСОКод="GLD" ЦБ.ВидЦБ.Мнемокод="Денежные средства" Стоимость="2961.00"/>
        <Row Портфель.DocID="1702531" ЦБ.ВалютаНоминала.ИСОКод="RUR" ЦБ.ВидЦБ.Мнемокод="Ипотечные сертификаты участия" Стоимость="0.00"/>
    </AccountState>

Тэг `Row` атрибут `Портфель.DocID` — DocID договора
Тэг `Row` атрибут `ЦБ.ВалютаНоминала.ИСОКод` — ИСО код валюты номинала 
Тэг `Row` атрибут `ЦБ.ВидЦБ.Мнемокод` — вид ЦБ
Тэг `Row` атрибут `Стоимость` — рыночная стоимость торгового портфеля


----------
----------

**Дальнейшее в рамках УРМОКС не используется**

----------
----------
## Пример для TableSplit=0 (без разбиения)

`$t9->ProcCall('web.FrontOffice', 'GetUserAccountState', '[AgreementID=1702531,TableSplit=0]')`


    <AccountState AgreementID="1702531" AgreementCode="" Date="16.06.2017">
        <Row ЦБ.ОснЕдИзм="{Базовый.Справочники.ЕдиницаИзмерения:13}" ЦБ.ВидЦБ.Мнемокод="ДенСредства" ЦБ.ТипЦБ.Имя="" ЦБ.Эмитент.Имя="Денежные средства" ЦБ.НомерГосРегистрации="" ЦБ.ISIN="" ЦБ.DocID="29" ЦБ.Мнемокод="01_руб" ЦБ.Имя="RUR" ЦБ="{Базовый.Данные.Ресурс:29}" Количество_Нач="0" ЕдИзмКоличество_Нач.Код="" Количество58_Нач="0" ЕдИзмКоличество58_Нач.Код="" Куплено_Об="0" Продано_Об="0" Зачисленно_Об="0" Списано_Об="0" Количество="2000" ЕдИзмКоличество.Код="руб" Количество58="2000" ЕдИзмКоличество58.Код="" Стоимость="2000" Стоимость58="2000" Оценка="0" Оценка58="0" УНКД="0" УНКД58="0" НКД_="0" ЦБ.Номинал="0" ЦБ.ВалютаНоминала.ИСОКод="RUR" ЦБ.КотирЗаДень.Close="0" ЦБ.КотирЗаДень.Bid="0" ЦБ.КотирЗаДень.Ask="0" ЦБ.КотирЗаДень.cur_Close.Код="" ЦБ.КотирЗаДень.cur_Bid.Код="" ЦБ.КотирЗаДень.cur_Ask.Код="" ЦБ.КотирЗаДень.Bloom_close_price="0" ЦБ.КотирЗаДень.Bloom_bid_price="0" ЦБ.КотирЗаДень.Bloom_ask_price="0" ЦБ.КотирЗаДень.cur_Bloom_close_price.Код="" ЦБ.КотирЗаДень.cur_Bloom_bid_price.Код="" ЦБ.КотирЗаДень.cur_Bloom_ask_price.Код="" ЦБ.КотирЗаДень.ГО_Продажа="0" ЦБ.КотирЗаДень.ГО_Покупка="0" ЦБ.ТекНКД="0"/>
        <Row ЦБ.ОснЕдИзм="{Базовый.Справочники.ЕдиницаИзмерения:211}" ЦБ.ВидЦБ.Мнемокод="ДенСредства" ЦБ.ТипЦБ.Имя="" ЦБ.Эмитент.Имя="Денежные средства" ЦБ.НомерГосРегистрации="" ЦБ.ISIN="" ЦБ.DocID="322556" ЦБ.Мнемокод="ДС_CNY" ЦБ.Имя="CNY" ЦБ="{Базовый.Данные.Ресурс:322556}" Количество_Нач="0" ЕдИзмКоличество_Нач.Код="" Количество58_Нач="0" ЕдИзмКоличество58_Нач.Код="" Куплено_Об="0" Продано_Об="0" Зачисленно_Об="0" Списано_Об="0" Количество="1000" ЕдИзмКоличество.Код="cny" Количество58="1000" ЕдИзмКоличество58.Код="" Стоимость="1000" Стоимость58="1000" Оценка="0" Оценка58="0" УНКД="0" УНКД58="0" НКД_="0" ЦБ.Номинал="0" ЦБ.ВалютаНоминала.ИСОКод="CNY" ЦБ.КотирЗаДень.Close="0" ЦБ.КотирЗаДень.Bid="0" ЦБ.КотирЗаДень.Ask="0" ЦБ.КотирЗаДень.cur_Close.Код="" ЦБ.КотирЗаДень.cur_Bid.Код="" ЦБ.КотирЗаДень.cur_Ask.Код="" ЦБ.КотирЗаДень.Bloom_close_price="0" ЦБ.КотирЗаДень.Bloom_bid_price="0" ЦБ.КотирЗаДень.Bloom_ask_price="0" ЦБ.КотирЗаДень.cur_Bloom_close_price.Код="" ЦБ.КотирЗаДень.cur_Bloom_bid_price.Код="" ЦБ.КотирЗаДень.cur_Bloom_ask_price.Код="" ЦБ.КотирЗаДень.ГО_Продажа="0" ЦБ.КотирЗаДень.ГО_Покупка="0" ЦБ.ТекНКД="0"/>
    </AccountState>

**Информация об активе (ЦБ/ДС)**
Тэг `Row` атрибут `ЦБ.DocID` — DocID актива
Тэг `Row` атрибут `ЦБ.Мнемокод` — код актива
Тэг `Row` атрибут `ЦБ.Имя` — наименование актива
Тэг `Row` атрибут `ЦБ.ОснЕдИзм` — единица измерения актива (формат DocIDStr: {Базовый.Справочники.ЕдиницаИзмерения:13})
Тэг `Row` атрибут `ЦБ.ВидЦБ.Мнемокод` — вид ЦБ
Тэг `Row` атрибут `ЦБ.ТипЦБ.Имя` — тип ЦБ
Тэг `Row` атрибут `ЦБ.Эмитент.Имя` — наименование эмитента (для ДС: “Денежные средства”)
Тэг `Row` атрибут `ЦБ.НомерГосРегистрации` — номер гос. регистрации
Тэг `Row` атрибут `ЦБ.ISIN` — ISIN
Тэг `Row` атрибут `ЦБ.ВалютаНоминала.ИСОКод` — ИСО код валюты номинала 
Тэг `Row` атрибут `ЦБ.Номинал` — номинал актива (для ДС - 0)
Тэг `Row` атрибут `ЦБ.ТекНКД` — НКД начисленный (рыночный, для текущих остатков)
Тэг `Row` атрибут `НКД_` — НКД начисленный (рыночный, для архивных остатков)
**Количественные параметры - торговый портфель**
Тэг `Row` атрибут `Количество_Нач` — вх. остаток
Тэг `Row` атрибут `Куплено_Об` — оборот - зачислено
Тэг `Row` атрибут `Продано_Об` — оборот - списано
Тэг `Row` атрибут `Количество` — исх. остаток
Тэг `Row` атрибут `Стоимость` — бал. стоимость
Тэг `Row` атрибут `Оценка` — рыночная оценка
Тэг `Row` атрибут `УНКД` — НКД (балансовый)
Тэг `Row` атрибут `ЕдИзмКоличество_Нач.Код` — валюта вх. остатка
Тэг `Row` атрибут `ЕдИзмКоличество.Код` — валюта исх. остатка
**Количественные параметры - фактические остатки/обороты**
Тэг `Row` атрибут `Количество58_Нач` — вх. остаток
Тэг `Row` атрибут `Зачисленно_Об` — оборот - зачислено
Тэг `Row` атрибут `Списано_Об` — оборот - списано
Тэг `Row` атрибут `Количество58` — исх. остаток
Тэг `Row` атрибут `Стоимость58` — бал. стоимость
Тэг `Row` атрибут `Оценка58` — рыночная оценка
Тэг `Row` атрибут `УНКД58` — НКД (балансовый)
Тэг `Row` атрибут `ЕдИзмКоличество58_Нач.Код` — валюта вх. остатка
Тэг `Row` атрибут `ЕдИзмКоличество58.Код` — валюта исх. остатка
**Котировки**
Тэг `Row` атрибут `ЦБ.КотирЗаДень.Close` — 
Тэг `Row` атрибут `ЦБ.КотирЗаДень.Bid` — 
Тэг `Row` атрибут `ЦБ.КотирЗаДень.Ask` — 
Тэг `Row` атрибут `ЦБ.КотирЗаДень.cur_Close.Код` — 
Тэг `Row` атрибут `ЦБ.КотирЗаДень.cur_Bid.Код` — 
Тэг `Row` атрибут `ЦБ.КотирЗаДень.cur_Ask.Код` — 
Тэг `Row` атрибут `ЦБ.КотирЗаДень.Bloom_close_price` — 
Тэг `Row` атрибут `ЦБ.КотирЗаДень.Bloom_bid_price` — 
Тэг `Row` атрибут `ЦБ.КотирЗаДень.Bloom_ask_price` — 
Тэг `Row` атрибут `ЦБ.КотирЗаДень.cur_Bloom_close_price.Код` — 
Тэг `Row` атрибут `ЦБ.КотирЗаДень.cur_Bloom_bid_price.Код` — 
Тэг `Row` атрибут `ЦБ.КотирЗаДень.cur_Bloom_ask_price.Код` — 
Тэг `Row` атрибут `ЦБ.КотирЗаДень.ГО_Продажа` — 
Тэг `Row` атрибут `ЦБ.КотирЗаДень.ГО_Покупка` — 


----------
## Пример для TableSplit=1 (разбиение по счетам)

`$t9->ProcCall('web.FrontOffice', 'GetUserAccountState', '[AgreementID=1702531,TableSplit=1]')`


    <AccountState AgreementID="1702531" AgreementCode="" Date="15.06.2017">
        <Table Портфель="{Управление.Данные.Процесс:1713488}" DocID="1713488" Код="088606636" КодФО="088606636">
            <Row ЦБ.ОснЕдИзм="{Базовый.Справочники.ЕдиницаИзмерения:211}" ЦБ.ВидЦБ.Мнемокод="ДенСредства" ЦБ.ТипЦБ.Имя="" ЦБ.Эмитент.Имя="Денежные средства" ЦБ.НомерГосРегистрации="" ЦБ.ISIN="" ЦБ.DocID="322556" ЦБ.Мнемокод="ДС_CNY" ЦБ.Имя="CNY" ЦБ="{Базовый.Данные.Ресурс:322556}" Количество_Нач="0" ЕдИзмКоличество_Нач.Код="" Количество58_Нач="0" ЕдИзмКоличество58_Нач.Код="" Куплено_Об="0" Продано_Об="0" Зачисленно_Об="0" Списано_Об="0" Количество="1000" ЕдИзмКоличество.Код="cny" Количество58="1000" ЕдИзмКоличество58.Код="" Стоимость="1000" Стоимость58="0" Оценка="0" Оценка58="0" УНКД="0" УНКД58="0" НКД_="0" ЦБ.Номинал="0" ЦБ.ВалютаНоминала.ИСОКод="CNY" ЦБ.КотирЗаДень.Close="0" ЦБ.КотирЗаДень.Bid="0" ЦБ.КотирЗаДень.Ask="0" ЦБ.КотирЗаДень.cur_Close.Код="" ЦБ.КотирЗаДень.cur_Bid.Код="" ЦБ.КотирЗаДень.cur_Ask.Код="" ЦБ.КотирЗаДень.Bloom_close_price="0" ЦБ.КотирЗаДень.Bloom_bid_price="0" ЦБ.КотирЗаДень.Bloom_ask_price="0" ЦБ.КотирЗаДень.cur_Bloom_close_price.Код="" ЦБ.КотирЗаДень.cur_Bloom_bid_price.Код="" ЦБ.КотирЗаДень.cur_Bloom_ask_price.Код="" ЦБ.КотирЗаДень.ГО_Продажа="0" ЦБ.КотирЗаДень.ГО_Покупка="0" ЦБ.ТекНКД="0"/>
        </Table>
        <Table Портфель="{Управление.Данные.Процесс:1702594}" DocID="1702594" Код="097165280" КодФО="097165280">
            <Row ЦБ.ОснЕдИзм="{Базовый.Справочники.ЕдиницаИзмерения:13}" ЦБ.ВидЦБ.Мнемокод="ДенСредства" ЦБ.ТипЦБ.Имя="" ЦБ.Эмитент.Имя="Денежные средства" ЦБ.НомерГосРегистрации="" ЦБ.ISIN="" ЦБ.DocID="29" ЦБ.Мнемокод="01_руб" ЦБ.Имя="RUR" ЦБ="{Базовый.Данные.Ресурс:29}" Количество_Нач="0" ЕдИзмКоличество_Нач.Код="" Количество58_Нач="0" ЕдИзмКоличество58_Нач.Код="" Куплено_Об="0" Продано_Об="0" Зачисленно_Об="0" Списано_Об="0" Количество="1000" ЕдИзмКоличество.Код="руб" Количество58="1000" ЕдИзмКоличество58.Код="" Стоимость="1000" Стоимость58="0" Оценка="0" Оценка58="0" УНКД="0" УНКД58="0" НКД_="0" ЦБ.Номинал="0" ЦБ.ВалютаНоминала.ИСОКод="RUR" ЦБ.КотирЗаДень.Close="0" ЦБ.КотирЗаДень.Bid="0" ЦБ.КотирЗаДень.Ask="0" ЦБ.КотирЗаДень.cur_Close.Код="" ЦБ.КотирЗаДень.cur_Bid.Код="" ЦБ.КотирЗаДень.cur_Ask.Код="" ЦБ.КотирЗаДень.Bloom_close_price="0" ЦБ.КотирЗаДень.Bloom_bid_price="0" ЦБ.КотирЗаДень.Bloom_ask_price="0" ЦБ.КотирЗаДень.cur_Bloom_close_price.Код="" ЦБ.КотирЗаДень.cur_Bloom_bid_price.Код="" ЦБ.КотирЗаДень.cur_Bloom_ask_price.Код="" ЦБ.КотирЗаДень.ГО_Продажа="0" ЦБ.КотирЗаДень.ГО_Покупка="0" ЦБ.ТекНКД="0"/>
        </Table>
    </AccountState>

**Информация о счёте (портфеле)**
Тэг `Table` атрибут `DocID` — DocID счета (портфеля)
Тэг `Table` атрибут `Код` — код счета (портфеля)
Тэг `Table` атрибут `КодФО` — наименование счета (портфеля)
Атрибуты тэга `Row` идентичны TableSplit=0


----------
## Расчет рыночной стоимости

Для текущих остатков рыночная стоимость считается по формуле:

    $cnt * (currentPrice($market) + $curAcc)

где

    $cnt - исх. остаток (атрибут 'Количество' или 'Количество58')
    $curAcc - НКД начисленный (атрибут 'ЦБ.ТекНКД')
    $market - рыночная оценка (атрибут 'Оценка' или 'Оценка58')



----------

